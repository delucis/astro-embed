---
import {
	AppBskyEmbedExternal,
	AppBskyEmbedImages,
	AppBskyEmbedRecord,
	AppBskyEmbedRecordWithMedia,
	AppBskyEmbedVideo,
	AppBskyGraphDefs,
} from '@atcute/bluesky';
import { is } from '@atcute/lexicons';
import External from './external.astro';
import ImageGrid from './image-grid.astro';
import List from './list.astro';
import QuoteEmbed from './quote-embed.astro';
import StarterPack from './starter-pack.astro';
import type { EmbedView } from './types';
import VideoThumbnail from './video-thumbnail.astro';

interface Props {
	embed?: EmbedView | undefined | null;
	postUrl: string;
	compact?: boolean | undefined;
}

const { embed, postUrl, compact } = Astro.props;
---

{
	is(AppBskyEmbedRecordWithMedia.viewSchema, embed) ? (
		<div class="record-with-media">
			<Astro.self embed={embed.media} postUrl={postUrl} compact={compact} />
			<QuoteEmbed embed={embed.record} />
		</div>
	) : is(AppBskyEmbedExternal.viewSchema, embed) ? (
		<External embed={embed} compact={compact} />
	) : is(AppBskyEmbedImages.viewSchema, embed) ? (
		<a href={postUrl}>
			<ImageGrid images={embed.images} />
		</a>
	) : is(AppBskyEmbedVideo.viewSchema, embed) ? (
		<a href={postUrl}>
			<VideoThumbnail
				thumbnail={embed.thumbnail}
				aspectRatio={embed.aspectRatio}
			/>
		</a>
	) : is(AppBskyGraphDefs.starterPackViewBasicSchema, embed?.record) ? (
		<StarterPack record={embed.record} />
	) : is(AppBskyGraphDefs.listViewSchema, embed?.record) ? (
		<List record={embed.record} />
	) : is(AppBskyEmbedRecord.viewSchema, embed) ? (
		<QuoteEmbed embed={embed} />
	) : !embed ? null : (
		embed?.$type
	)
}

<style>
	.record-with-media {
		display: flex;
		flex-direction: column;
		gap: var(--bluesky-space-sm);
	}
</style>
