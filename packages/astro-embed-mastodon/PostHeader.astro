---
import type { MastodonStatus } from './types';
import { replaceEmojis } from './utils';

interface Props {
	post: MastodonStatus;
}

const { post } = Astro.props;

const { hostname } = new URL(post.account.url);
const username = `${post.account.username}@${hostname}`;
---

<div part="post-header">
	<a part="post-header-user" href={post.account.url}>
		<img
			part="post-header-user-avatar"
			src={post.account.avatar_static}
			alt=""
			width="46"
			height="46"
			loading="lazy"
			decoding="async"
		/>
		<span part="post-header-user-content">
			<bdi>
				<strong
					part="post-header-user-display-name"
					set:html={replaceEmojis(
						post.account.display_name || post.account.username,
						post.account.emojis
					)}
				/>
			</bdi>
			<span part="post-header-user-account">@{username}</span>
		</span>
	</a>
	<a href={post.url}>
		<span class="invisible">View on Mastodon</span>
		<svg
			{...{
				part: 'post-header-mastodon-logo',
			} /* `part` is missing in Astroâ€™s types for SVGs, so this is a workaround to avoid type errors */}
			width="40"
			height="40"
			viewBox="0 -4 79 79"
			aria-hidden="true"
		>
			<path
				d="M63 45.3v-20c0-4.1-1-7.3-3.2-9.7-2.1-2.4-5-3.7-8.5-3.7-4.1 0-7.2 1.6-9.3 4.7l-2 3.3-2-3.3c-2-3.1-5.1-4.7-9.2-4.7-3.5 0-6.4 1.3-8.6 3.7-2.1 2.4-3.1 5.6-3.1 9.7v20h8V25.9c0-4.1 1.7-6.2 5.2-6.2 3.8 0 5.8 2.5 5.8 7.4V37.7H44V27.1c0-4.9 1.9-7.4 5.8-7.4 3.5 0 5.2 2.1 5.2 6.2V45.3h8ZM74.7 16.6c.6 6 .1 15.7.1 17.3 0 .5-.1 4.8-.1 5.3-.7 11.5-8 16-15.6 17.5-.1 0-.2 0-.3 0-4.9 1-10 1.2-14.9 1.4-1.2 0-2.4 0-3.6 0-4.8 0-9.7-.6-14.4-1.7-.1 0-.1 0-.1 0s-.1 0-.1 0 0 .1 0 .1 0 0 0 0c.1 1.6.4 3.1 1 4.5.6 1.7 2.9 5.7 11.4 5.7 5 0 9.9-.6 14.8-1.7 0 0 0 0 0 0 .1 0 .1 0 .1 0 0 .1 0 .1 0 .1.1 0 .1 0 .1.1v5.6s0 .1-.1.1c0 0 0 0 0 .1-1.6 1.1-3.7 1.7-5.6 2.3-.8.3-1.6.5-2.4.7-7.5 1.7-15.4 1.3-22.7-1.2-6.8-2.4-13.8-8.2-15.5-15.2-.9-3.8-1.6-7.6-1.9-11.5-.6-5.8-.6-11.7-.8-17.5C3.9 24.5 4 20 4.9 16 6.7 7.9 14.1 2.2 22.3 1c1.4-.2 4.1-1 16.5-1h.1C51.4 0 56.7.8 58.1 1c8.4 1.2 15.5 7.5 16.6 15.6Z"
				fill="currentColor"></path>
		</svg>
	</a>
</div>

<style is:global>
	astro-embed-mastodon::part(post-header) {
		display: flex;
		align-items: center;
		justify-content: space-between;
		font-size: 0.9375em;
		line-height: 1.467em;
		gap: 0.667em;
	}
	astro-embed-mastodon::part(post-header-user) {
		display: flex;
		align-items: center;
		gap: 0.667em;
		overflow: hidden;

		text-decoration: none;
		color: inherit;
	}
	astro-embed-mastodon::part(post-header-user-avatar) {
		border-radius: var(--mc-border-radius);
		width: 3em;
		height: 3em;
		object-fit: cover;
	}
	astro-embed-mastodon::part(post-header-user-content) {
		max-width: 100%;
		display: flex;
		flex-direction: column;

		white-space: nowrap;
		overflow: hidden;

		color: var(--mc-color-secondary);
	}
	astro-embed-mastodon::part(post-header-user-display-name) {
		font-weight: 600;
		color: var(--mc-color-primary);
	}
	astro-embed-mastodon::part(post-header-user-display-name),
	astro-embed-mastodon::part(post-header-user-account) {
		display: block;
		text-overflow: ellipsis;
		overflow: hidden;
	}

	astro-embed-mastodon::part(post-header-mastodon-logo) {
		color: var(--mc-color-secondary);
		width: 2.5em;
		height: 2.5em;
	}
</style>
